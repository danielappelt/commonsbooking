/*
 * Admin screen popups
 *
 * Hande the display and reordering of meta boxes on cb admin popup screens
 * WP List table screens: _listtables.scss
 *
 * @package   CommonsBooking2
 * @author Florian Egermann <florian@wielebenwir.de>
 * @license   GPL-2.0+
 * @since 0.2
 * @link      http://www.wielebenwir.de
 * @copyright 2015 wielebenwir+
 */


.cb-admin-page {


	/* General editing popup */
	#TB_window {
		/* Annesley: temporary weird fix to prevent the thickbox re-sizing on normal post screens */
		height:auto!important;

		.cmb-th, .cmb-td {
			padding: 0;
		}

		.cb-nexts, .cb-popup-form-next {
			display: none !important;
		}

		@include round-rect(all);
		background: #FFF;

		.cb-display-type-hidden {
			display: none;
		}

		/* processing overlay */
		.cb-processing-overlay {
			display:none;
			position: absolute;
			left: 0;
			right: 0;
			top: 0;
			bottom: 0;
			background-color: $color-blue-dark;
			z-index: 99;
		}

		/* Color the background */
		@extend .cb-period-status-available; /*standard */
			&.cb-status-open  {
				@extend .cb-period-status-open;
			}
			&.cb-blocked  {
				@extend .cb-period-status-blocked;
			}
			&.cb-status-booked  {
				@extend .cb-period-status-unconfirmed;
				&.cb-status-confirmed  {
					@extend .cb-period-status-booked;
				}
			}

		/* Show/hide actions  */
		&.cb-status-pickup-return .cb-actions {
			.cb-action-unconfirm,
			.cb-action-trash {
				display:none;
			 }
		}
		&.cb-status-booked .cb-actions {
			.cb-action-unconfirm {
				display:none;
			 }
		}

		/* Addto */
		&.cb-popup-addto  {
			#cb_PeriodEntity_Timeframe_User_location,
			#cb_PeriodEntity_Timeframe_User_item,
			#cb_PeriodEntity_Timeframe_User_user			{ @extend .metabox-popup; }
		}

	/* HEADER */
	#TB_title {

		height:auto;
		border-bottom:none;
		background: #FFF;
		overflow: hidden;
		@include round-rect(top);
		padding: $padding-small;

		#TB_ajaxWindowTitle {

		}
	}

	.TB_window_styles {
		display: none;
	}

	.TB_title_actions {
		padding: $padding;
		color: $color-white;
		display: flex;
		flex-wrap: wrap;
		flex-direction: row;
		width: 100%;

		div.cb-period-info, .cb-actions {
			width: 40%;
			margin: 0;
		}

		h2 {
			padding: 0;
			margin: 0;
		}

		.cb-actions {

			/* Hide unwanted buttons */
			.cb-action-duplicate {
				display: none;
			}
			input {
				@extend .cb-admin-button;
				float: right;
				margin: 0 $element-spacing;
			}
		}
		.cb-addto & {
			a { text-decoration: none; }
		}
		h2, a { color: $color-white;
			text-decoration: none;
		}

	}


	/* Period date/time picker */
	#cb-ajax-edit-form {
		button#cb-different-dates {
			border: 0;
			color: $wp-blue;
		}
		button#cb-set-full-day {
			@extend .cb-admin-button;
			position: absolute;
			right: 0;
			top: 30px;
		}


		#cmb2-metabox-cb_Period_period {
			.cmb2-datepicker {
				display: block;
			}
		}
		// &.cb-same-dates {	/* Do not show date field if the startdate/enddate are the same */
		// 	#cmb2-metabox-cb_Period_period {
		// 		.cmb2-datepicker {
		// 			display: none;
		// 		}
		// 	}
		// }
	}

	&.cb-status-pickup-return,
	&.cb-status-open {	/* Do not show date field for opening hours & pickup/return */
		#cmb2-metabox-cb_Period_period {
			.cmb2-datepicker {
				display: none !important;
			}
		}
	}


	/* CONTENT - FORM */

	#TB_ajaxContent {
		@include round-rect(bottom);
		background: #FFF;
		padding: $padding;
		position: relative;


		/* Addto: nexts */
		.cb-popup-form-next {
			position: absolute;
			right: $padding;
			top: $padding;
		}

		ul.cb-nexts {
			display: block;
			width: 100%;
			overflow: hidden;
			li {
				&:first-of-type { /* hide type, since we have that selected above */
					display: none;
				}
				float: left;
			}
			a {
				@extend .cb-admin-button;
			}
		}

	}

	}


	#TB_window.cb-popup {

		/* Save button row */
		.cb-actions {
			margin-top:10px;
			display: flex;
			align-items: flex-end;
			justify-content: flex-end
		}
		.cb-submit {
			display:none;
		}
		.cb-popup-form-save,
		.cb-popup-form-next,
		.cb-popup-form-cancel,
		.cb-popup-form-trash {
			@extend .cb-admin-button;
			margin-left: $element-spacing;
		}
		.cb-popup-form-save {
			@extend .cb-admin-button-save;
			order: 99;

		}
		.cb-popup-form-trash {
			color:red;
			border: none;
			order: 1;
			text-align: left;
			align-self: flex-start;
			margin-right: auto;
		}
		.cb-popup-form-cancel {
			order: 2;
		}
		.cb-popup-form-next {
			order: 3;
		}


		#cb-tab-objects .postbox {
			h2 {
				/* display:block; */
				border-bottom: none;
			}
			.cmb-row:after {
				display:none;
			}
		}

		.cmb2-metabox .cmb2-id-exceptions {
			display:none;
		}

		/* Saving effect @TODO */
		&.cb-saving {
			.cb-processing-overlay {
				display: block;
				opacity:0.7;
			}
			.cb-popup-form-save {
				color:#aaa;
				cursor:no-drop;
			}
		}
		&.cb-refreshing {
			.cb-processing-overlay {
				display: block;
				opacity:0.7;
			}
			.cb-popup-form-save {
				color:#aaa;
				cursor:no-drop;
			}
		}

		/* radio buttons */
		.cmb-type-radio.cmb2-id-period-status-type-ID label {
			color:#fff;
			margin:4px 4px;
			padding:6px 6px;
			border-radius: 5px;
		}

		/* standard simple objects for each status type
		 * an advanced option shows all
		 */
		.cb-advanced {
			#cb_PeriodEntity_Timeframe_User_user,
			#cb_PeriodEntity_Timeframe_User_item
			{display:block!important;}
		}
		&.cb-status-pickup-return,
		&.cb-status-1 {
			#cb_PeriodEntity_Timeframe_User_user
			{display:none;}
		}
		&.cb-status-booked,
		&.cb-status-2 {
			.cb-add-class-advanced {display:none;}
		}
		&.cb-status-closed,
		&.cb-status-3 {
			#cb_PeriodEntity_Timeframe_User_user,
			#cb_PeriodEntity_Timeframe_User_item
			{display:none;}
		}
		&.cb-status-open,
		&.cb-status-4 {
			#cb_PeriodEntity_Timeframe_User_user,
			#cb_PeriodEntity_Timeframe_User_item
			{display:none;}
		}
		&.cb-status-repair,
		&.cb-status-5 {
			.cb-add-class-advanced {display:none;}
		}
		&.cb-status-holiday,
		&.cb-status-6 {
			#cb_PeriodEntity_Timeframe_User_user,
			#cb_PeriodEntity_Timeframe_User_item
			{display:none;}
		}
	}

	#TB_window.cb-popup-quick-create-opening-hours,
	#TB_window.cb-page-in-popup,
	#TB_window.cb-popup-addto,
	#TB_window.cb-popup-add {
		#TB_title #TB_ajaxWindowTitle {
			min-height:auto;
		}
	}

	#TB_window.cb-popup-quick-create-opening-hours #TB_title .TB_title_actions {
		display:none;
	}

	#TB_window.cb-no-recurrence #cb-save-types {
		display:none;
	}

	#TB_ajaxContent {
		height:auto!important;
		width:auto!important;

	}



	/* -------------------------- specific popups ------------------- */
	&.cb-post-new.cb-status-open,
	&.cb-post-new.cb-status-booked,
	&.cb-post-new.cb-status-pickup-return,
	&.cb-post-new.cb-status-4,
	&.cb-post-new.cb-status-2,
	&.cb-post-new.cb-status-1 {
		#post-body-content,
		#cb_PeriodEntity_Location_location,
		#cb_PeriodEntity_Location_status,
		.cmb-type-post-link a {
			display:none;
		}

		.cmb2-id-period-group-ID li {
			padding:8px;
		}
	}
	&.cb-post-new.cb-status-2 {
		#cmb2-metabox-cb_PeriodEntity_Timeframe_User_period_validity_override__optional_ {
			display:none;
		}
	}

	&.cb-popup-add {
	}
}
